<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>å¤§çƒåƒå°çƒ</title>
	</head>
	<style type="text/css">
		@font-face {
			font-family: Lb;
			src: url(bb1491-1/lbt.ttf);
		}
		
		canvas {
			margin: 0 auto;
			display: block;
			box-shadow: 0 0 50px gray;
			border-radius: 5px;
			margin-top: 50px;
			font-family: 'Lb';
			background: rgb(240, 240, 240);
		}
		
		p {
			font-family: 'Lb';
			font-size: 0px;
		}
	</style>

	<body>
		<canvas id="canvas" width="900" height="800">123</canvas>
		<!--<audio src="å¢¨è‘‰JUN - å½©è±†æ£®æ—.mp3" autoplay loop></audio>-->
		<p>.</p>
	</body>
	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	<script type="text/javascript">
	window.onload = function() { //htmlåŠ è½½å®Œåå†æ‰§è¡Œjs
		var can = document.getElementById('canvas');
		var ctx = can.getContext('2d'); //ç”»ç¬”
		var stararc; //å¼€å§‹ç•Œé¢çš„è®¡æ—¶å™¨
		var ox; //é¼ æ ‡åŸºäºcanvasçš„åæ ‡
		var oy;
		var myr = 3; //åˆå§‹åŒ–å°çƒåŠå¾„
		var ballarr = []; //éšœç¢å°çƒçš„æ•°ç»„
		var myreq; //requestanmationå›è°ƒid
		var score = 0;//åƒæ‰çš„å°çƒä¸ªæ•°
		var gameFlag=1;//æ¸¸æˆå¼€å…³
		//å°è£…éšæœºå‡½æ•°
		function random(x, y) {
			return Math.round(Math.random() * (y - x) + x);
		}
		//å¼€å§‹ç•Œé¢å‡½æ•°
		function gamestart() {
			//ç”»å‡ºä¸¤ä¸ªä¼šåŠ¨çš„åœ†
			var r1 = 100,
				r2 = 50,
				vr = 1;
			stararc = setInterval(function() {
				ctx.clearRect(0, 0, 900, 800);
				r1 += vr;
				r2 += vr;
				if(r1 >= 135) {
					vr = -vr;
				} else if(r1 < 100) {
					vr = -vr;
				}
				ctx.beginPath();
				ctx.fillStyle = 'rgb(45,205,195)';
				ctx.arc(310, 350, r1, 0, 2 * Math.PI);
				ctx.fill();
				ctx.beginPath();
				ctx.fillStyle = 'rgb(173,219,101)';
				ctx.arc(450, 420, r2, 0, 2 * Math.PI);
				ctx.fill();
				//ç”»å‡ºå­—ä½“
				ctx.font = '45px Lb';
				ctx.fillStyle = 'skyblue';
				ctx.fillText('å¤§çƒåƒå°çƒ', 260, 600);
				ctx.fillText('åƒæ‰æ¯”ä½ æ›´å°çš„çƒï¼', 450, 660);
			}, 25);
		}

		//å°è£…é¼ æ ‡å°çƒç±»
		function Mouseball() {}
		Mouseball.prototype.draw = function() {
			ctx.beginPath();
			ctx.fillStyle = 'rgb(0,0,0)';
			ctx.arc(ox, oy, myr, 0, 2 * Math.PI);
			ctx.fill();
		}
		//å®ä¾‹åŒ–å°çƒ
		var myball = new Mouseball();

		//å°è£…éšœç¢å°çƒç±»
		function Eneball(x, y, vx, vy, r, color) {
			this.x = x;
			this.y = y;
			this.r = r;
			this.vx = vx;
			this.vy = vy;
			this.color = color;
		}
		Eneball.prototype.move = function() { //éšœç¢å°çƒåŸå‹ç§»åŠ¨é‡ç»˜æ–¹æ³•
			this.x += this.vx;
			this.y += this.vy;
			ctx.beginPath();
			ctx.fillStyle = this.color;
			ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
			ctx.fill();
			//é£å‡ºç”»å¸ƒæ¸…é™¤å‡ºæ•°ç»„
			if(this.x < -300 || this.x > can.width + this.r || this.y < -300 || this.y > can.height + this.r) {
				ballarr.splice(ballarr.indexOf(this), 1);
			}
		}

		//åˆ›å»ºå°çƒ
		function createneball(r) {
			var des = random(1, 4); //éšæœºåœ¨å“ªæ¡è¾¹å‡ºç°
			if(des == 1) {
				var x = random(-r, can.width + r); //éšæœºxåæ ‡ï¼Œå·¦è¾¹æ¡†æˆ–è€…å³è¾¹æ¡†
				var y = 0;
				var vx = random(-2, 2);
				if(vx == 0) {
					vx++;
				}
				var vy = random(1, 2);
			} else if(des == 2) {
				var y = random(-r, can.height + r); //éšæœºyåæ ‡ï¼Œä¸Šè¾¹æ¡†æˆ–è€…ä¸‹è¾¹æ¡†
				var x = 0;
				var vy = random(-2, 2);
				if(vy == 0) {
					vy++;
				}
				var vx = random(1, 2);
			} else if(des == 3) {
				var y = random(-r, can.height + r); //éšæœºyåæ ‡ï¼Œä¸Šè¾¹æ¡†æˆ–è€…ä¸‹è¾¹æ¡†
				var x = can.width + r;
				var vy = random(-2, 2);
				if(vy == 0) {
					vy++;
				}
				var vx = random(-2, -1);
			} else if(des == 4) {
				var x = random(-r, can.width + r); //éšæœºxåæ ‡ï¼Œå·¦è¾¹æ¡†æˆ–è€…å³è¾¹æ¡†
				var y = can.height + r;
				var vx = random(-2, 2);
				if(vx == 0) {
					vx++;
				}
				var vy = random(-2, -1);
			}
			var color = 'rgb(' + random(50, 240) + ',' + random(50, 240) + ',' + random(50, 240) + ')';
			var newball = new Eneball(x, y, vx, vy, r, color); //å®ä¾‹åŒ–
			//æ·»åŠ å…¥å°çƒæ•°ç»„
			ballarr.push(newball);
		}

		//è·å–é¼ æ ‡ç§»åŠ¨åæ ‡
		can.onmousemove = function() {
			var e = event || window.event;
			ox = e.clientX - can.offsetLeft;
			oy = e.clientY - can.offsetTop;
		}
		//å…¨å±€ç»˜åˆ¶é¢‘ç‡è®¡æ—¶å™¨
		function alldraw() {
			ctx.clearRect(0, 0, 900, 800);
			//ç»˜åˆ¶é¼ æ ‡å°çƒ
			myball.draw();
			//ç»˜åˆ¶éšœç¢å°çƒ
			for(var i = 0; i < ballarr.length; i++) {
				ballarr[i].move();
			}
			if(ballarr.length < 50) {
				var r = random(myr * 0.7, myr + 14);
				createneball(r);
			}
			//å®æ—¶åˆ¤æ–­ç¢°æ’
			judgedig();
			//å›è°ƒ
			if(gameFlag==2){
				myreq = requestAnimationFrame(alldraw);
			}
		};

		//åˆ¤æ–­ç¢°æ’
		function judgedig() {
			for(var i = 0; i < ballarr.length; i++) {
				//è®¡ç®—åœ†å¿ƒè·
				var ballx = ballarr[i].x;
				var bally = ballarr[i].y;
				var rr = Math.sqrt(Math.pow(ballx - ox, 2) + Math.pow(bally - oy, 2));
				if(rr <= ballarr[i].r + myr) { //åˆ¤æ–­ç¢°æ’
					//åˆ¤æ–­ç¢°æ’åè°å¤§
					if(ballarr[i].r > myr || ballarr[i].r == myr) {
						//æ¸¸æˆç»“æŸ
						over();
						return;
					} else if(ballarr[i].r < myr) {
						//åƒæ‰
						myr = myr + Math.round(ballarr[i].r / myr); //å¢å¤§ä½“ç§¯
						ballarr.splice(i,1); //æ¸…é™¤è¿™ä¸ªéšœç¢å°çƒ
						i--;
						score++;
					}
				}
			}
		}
		//æ¸¸æˆä¸»å‡½æ•°
		gamestart();
		//ç”»å¸ƒçš„ç‚¹å‡»äº‹ä»¶
		can.onclick = function(){
			if(gameFlag==1){
				gameFlag=2;
				clearInterval(stararc);
				createneball();
				var newboj = $('<audio src="å¢¨è‘‰JUN - å½©è±†æ£®æ—.mp3" autoplay loop></audio>');
				$('body').append(newboj);
//				$('canvas').css({'cursor': 'url(more.ico),pointer'});
				myreq = requestAnimationFrame(alldraw);//åˆ·æ–°é¢‘ç‡
			}else if(gameFlag==0){
				gamestart();
				gameFlag=1;
			}
		}
		//æ¸¸æˆç»“æŸ
			function over() {
//				$('canvas').css({'cursor': 'default'});
				//æ˜¾ç¤ºç»“æŸé¡µé¢çš„ä¿¡æ¯
				$('audio').remove();
				ctx.beginPath();
				ctx.fillStyle = 'rgba(147,147,147,0.4)';
				ctx.fillRect(0, 0, 900, 800);
				ctx.beginPath();
				ctx.font = '55px Lb';
				ctx.fillStyle = 'white';
				ctx.fillText('æˆ‘çš„æˆç»©', 340, 200);
				//å¼•å…¥å›¾ç‰‡
				var img = new Image();
				img.src = 'bgt.png';
				img.onload = function() {//å›¾ç‰‡åŠ è½½å®Œåæ‰èƒ½ç”¨
					ctx.beginPath();
					ctx.drawImage(img, 140, 240, 600, 10);
					ctx.drawImage(img, 140, 510, 600, 10);
				}
				ctx.beginPath();
				ctx.font = '45px Lb';
				ctx.fillStyle = 'white';
				ctx.fillText('æ­å–œä½ ', 385, 350);
				ctx.beginPath();
				ctx.font = '35px Lb';//å¼•å…¥æˆ‘çš„å­—ä½“ğŸ˜Š
				ctx.fillStyle = 'white';
				ctx.fillText('åƒæ‰ '+score+' ä¸ªå°çƒ', 335, 410);
				//æ˜¾ç¤ºåˆ†æ•° å’Œå‡»è´¥äº†å¤šå°‘äºº
				var scall = Math.round(10000*score/55)/100;
				if(scall>=99.99){
					scall=99.99;
				}
				ctx.fillText('å‡»è´¥å…¨å›½ '+scall+' %çš„äºº', 315, 480);
				ctx.beginPath();
				ctx.font = '45px Lb';
				ctx.fillStyle = 'white';
				ctx.strokeText('ä¸æœå—ï¼Œç‚¹å‡»ä»»æ„ä½ç½®ç»§ç»­å‘€', 150, 620);
				//è¿˜åŸæ•°æ®
				myr = 3; //åˆå§‹åŒ–å°çƒåŠå¾„
				ballarr = []; //éšœç¢å°çƒçš„æ•°ç»„
				score = 0;//åƒæ‰çš„å°çƒä¸ªæ•°
				gameFlag=0;
			}
	}
	</script>

</html>